services:
  - type: web
    name: ritmo-app-api-qa
    env: node
    branch: hml
    buildCommand: npm install && npm run build
    startCommand: npm run start:render
    plan: free
    # Importante: Configuração para garantir que o Render detecte a porta corretamente
    healthCheckPath: /api/docs
    # Configuração para aumentar o tempo de espera antes de considerar o serviço como falho
    healthCheckTimeout: 300
    # Configuração para aumentar o tempo de inicialização permitido
    initialDeployHook: node render-env-setup.js && sleep 5
    envVars:
      - key: NODE_ENV
        value: qa
      - key: PORT
        value: 3000
      - key: DB_HOST
        fromDatabase:
          name: ritmodb
          property: host
      - key: DB_PORT
        fromDatabase:
          name: ritmodb
          property: port
      - key: DB_USERNAME
        fromDatabase:
          name: ritmodb
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: ritmodb
          property: password
      - key: DB_DATABASE
        fromDatabase:
          name: ritmodb
          property: database
      - key: DB_SYNCHRONIZE
        value: "true"
      - key: DB_MIGRATIONS_RUN
        value: "true"
      - key: DB_SSL
        value: "true"
      - key: JWT_SECRET
        fromGroup: qa-secrets
      - key: JWT_EXPIRATION
        value: 1d
      - key: CORS_ORIGIN
        value: "*"
